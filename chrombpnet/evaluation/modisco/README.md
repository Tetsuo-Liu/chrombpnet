
# Scripts to do MODSICO on deepshap output of ChromBPNet and generate a html link for the outputs with tomtom annotations

The scripts in this folder do the following three steps (1)  Do de-novo motif discovery on the deepshap output of chrombpnet using MODISCO (run_modisco.py) (2) Annotate the motifs using TOMTOM (fetch_tomtom.py) and (3) Summarize the output to a html format (visualize_motif_matches.py). 
So a requirement for this script is that the outputs generated from step 2 are html hostable. If you dont to host the results online you can remove the visualize_motif_matches.py from the run.sh script below. An example html link will look like this http://mitra.stanford.edu/kundaje/oak/projects/chromatin-atlas-2022/modisco/DNASE/ENCSR000EMA/ranked_feb15/profile.motifs.html.

## Usage

```
modisco.sh [scores_prefix] [output_dir] [score_type] [seqlets] [crop] [meme_db] [meme_logos] [vier_logos] [vier_html] [html_link]
```

The following assumptions are made with this script - make changes accordingly if the assumptions dont hold.

- The following scripts are used on the output of `chrombpnet_deepshap`. 

## Example Usage

```
modisco.sh /path/to/deepshap_scores/ /path/to/store/output/ counts_or_profiles 200000 1000 [meme_db] [meme_logos] [vier_logos] [vier_html] [html_link]
```

## Input Format

- scores_prefix: This is the `output_prefix` used with `chrombpnet_deepshap`. 
- score_type: This is either set to `counts` or `profile`.
- output_dir: Path to a directory to store the output files. The script assumes that the directory already exists. Look at the output format section below to understand the files generated.
- seqlets: Number of seqlets to use for modisco run. If using the most recent dev version of MODISCO this can be set to 200K. If using older version set to 50K. You can test the working of the script with a much smaller value - as this decides the runtime of the script.
- crop: An integer value representing the crop length to use on the chrombpnet input. In chrombpnet we get contribution scores for 2114 length input but we will run modisco on only 1000 length input. So the default value for this parameter is set to 1000. We do this to avoid catching "AT" rich nucleosome motifs that occur more frequently on the flanks of the 2114 length input.
- meme_db: Path to a txt file containing the meme motifs letter probability matrix. Text file to download - http://mitra.stanford.edu/kundaje/surag/resources/motif_archetypes/pfm_meme_format/motifs.meme.txt
- meme_logos: Path to a directory containing meme pfms - Directory to download - http://mitra.stanford.edu/kundaje/surag/resources/motif_archetypes/pfm/
- vier_logos: A directory with images for the pfms provided in `meme_logos`. If the image is not already present the script creates that image, so it is okay is this is an empty directory. This can be a database of meme images you can share across projects. Make sure that this directory is hostable if you are interedted in viewing the results in a html link. 
- vier_html: An html link to `vier_logos` folder. These links are used in `score_type.motifs.html` page created below in output format section. 
- html_link: An html link to `untrimmed_logos`. This is one of the outputs generated by run.sh. So you need to eitheir make sure output_dir/trimmed_logos is html hostable or you can copy `untrimmed_logos`  to the directory of the  html link you set here.


## Output Format

- modisco_results_allChroms_`score_type`.hdf5: Modisco output `hdf5` file.
- seqlets_`score_type`.txt: 
- `score_type`.tomtom.tsv: Tomom output.
- `score_type`.motifs.html: An html link where the modisco motifs are ranked based on their frequency. This html link will host html images provided in `html_link` and `vier_html`. 
- `untrimmed_logos_profile` or `untrimmed_logos_counts`: This directory will be created in `output_dir` path provided depending on `score_type`. This directory will store the motif images that are not trimmed.
- `trimmed_logos`: This directory will be created in `output_dir` path provided. This directory wil store the motif images that are trimmed based on the default threshold of 0.3 used in the scripts. Make sure this directory is hostable.

